<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Basic Example</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.16c93b31.css" as="style"><link rel="preload" href="/assets/js/app.38dc2da7.js" as="script"><link rel="preload" href="/assets/js/6.955488f3.js" as="script"><link rel="prefetch" href="/assets/js/10.f1607b87.js"><link rel="prefetch" href="/assets/js/11.5935f050.js"><link rel="prefetch" href="/assets/js/12.e6a5ca86.js"><link rel="prefetch" href="/assets/js/13.78ae9647.js"><link rel="prefetch" href="/assets/js/14.a029e60a.js"><link rel="prefetch" href="/assets/js/15.ffe0034a.js"><link rel="prefetch" href="/assets/js/16.1114c444.js"><link rel="prefetch" href="/assets/js/17.0f1b6827.js"><link rel="prefetch" href="/assets/js/18.a3e3e402.js"><link rel="prefetch" href="/assets/js/19.ef7aad5c.js"><link rel="prefetch" href="/assets/js/2.da451cf3.js"><link rel="prefetch" href="/assets/js/20.e0b1db2d.js"><link rel="prefetch" href="/assets/js/21.40954eb3.js"><link rel="prefetch" href="/assets/js/22.212fc021.js"><link rel="prefetch" href="/assets/js/23.a314009f.js"><link rel="prefetch" href="/assets/js/24.cd8f299f.js"><link rel="prefetch" href="/assets/js/25.d2e6dbd5.js"><link rel="prefetch" href="/assets/js/26.7c8fed17.js"><link rel="prefetch" href="/assets/js/27.aca225c8.js"><link rel="prefetch" href="/assets/js/28.8015e33a.js"><link rel="prefetch" href="/assets/js/29.18be192f.js"><link rel="prefetch" href="/assets/js/3.3a07ef4f.js"><link rel="prefetch" href="/assets/js/30.bf2c58ed.js"><link rel="prefetch" href="/assets/js/31.7d298cf9.js"><link rel="prefetch" href="/assets/js/32.acbdc620.js"><link rel="prefetch" href="/assets/js/33.b37a3e52.js"><link rel="prefetch" href="/assets/js/34.a6d5a9bf.js"><link rel="prefetch" href="/assets/js/35.aef6c1df.js"><link rel="prefetch" href="/assets/js/36.fed52b27.js"><link rel="prefetch" href="/assets/js/37.1a2efafc.js"><link rel="prefetch" href="/assets/js/38.99baad0c.js"><link rel="prefetch" href="/assets/js/39.3dd6385d.js"><link rel="prefetch" href="/assets/js/4.8d350108.js"><link rel="prefetch" href="/assets/js/5.e19c8ee8.js"><link rel="prefetch" href="/assets/js/7.0f86fe07.js"><link rel="prefetch" href="/assets/js/8.b867c26c.js"><link rel="prefetch" href="/assets/js/9.e743477c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.16c93b31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/compuware.png" alt="" class="logo"> <!----></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/pipelines/" class="nav-link router-link-active">Pipelines</a></div><div class="nav-item"><a href="/tool_configuration/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/code_examples/" class="nav-link">APIs</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/pipelines/" class="nav-link router-link-active">Pipelines</a></div><div class="nav-item"><a href="/tool_configuration/" class="nav-link">Configuration</a></div><div class="nav-item"><a href="/code_examples/" class="nav-link">APIs</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/pipelines/" class="sidebar-link">Getting Started</a></li><li><a href="/pipelines/pipelines.html" class="sidebar-link">Example Pipelines</a></li><li><a href="/pipelines/Mainframe_CI_Pipeline_from_Shared_Lib.html" class="sidebar-link">Shared Library Example</a></li><li><a href="/pipelines/Mainframe-CI-Example-pipeline.html" class="active sidebar-link">Basic Example</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pipelines/Mainframe-CI-Example-pipeline.html#setting-up-the-pipeline-job" class="sidebar-link">Setting up the pipeline job</a></li><li class="sidebar-sub-header"><a href="/pipelines/Mainframe-CI-Example-pipeline.html#jenkins-pipeline-script" class="sidebar-link">Jenkins Pipeline Script</a></li></ul></li><li><a href="/pipelines/scenario/" class="sidebar-link">ISPW Scenario</a></li><li><a href="/pipelines/scenario/TTT_scenario.html" class="sidebar-link">Total Test User Scenario</a></li><li><a href="/pipelines/pipeline_parameters.html" class="sidebar-link">Pipeline Parameters</a></li><li><a href="/pipelines/config_files.html" class="sidebar-link">Configuration Files</a></li><li><a href="/pipelines/helper_classes/" class="sidebar-link">Helper classes</a></li><li><a href="/pipelines/Jenkins_Groovy.html" class="sidebar-link">Groovy Tips</a></li></ul> </div> <div class="page"> <div class="content"><h2 id="setting-up-the-pipeline-job"><a href="#setting-up-the-pipeline-job" aria-hidden="true" class="header-anchor">#</a> Setting up the pipeline job</h2> <p>The job itself is defined the usual way by creating a new pipeline job. It is important, though, to make sure that the resulting job uses parameters by checking the `This project is parameterized' box.</p> <p><img src="/assets/img/parametertized_pipeline.261b5a73.png" alt="Parameterized Pipeline"></p> <h3 id="the-pipeline-parameters"><a href="#the-pipeline-parameters" aria-hidden="true" class="header-anchor">#</a> The pipeline parameters</h3> <p>Succesively add the following string parameters (the default values are the ones used for the examples).</p> <p><img src="/assets/img/Adding_parameters.534c25bf.png" alt="Adding parameters"></p> <p>The parameters in this first set are specific to the individual execution of the pipeline and get passed by the <a href="/tool_configuration/webhook_setup.html">ISPW Webhook</a></p> <table><thead><tr><th>Name</th> <th>Default Value</th> <th>Description</th></tr></thead> <tbody><tr><td>ISPW_Stream</td> <td>FTSDEMO</td> <td>ISPW Stream Name</td></tr> <tr><td>ISPW_Application</td> <td>RXN3</td> <td>ISPW Application</td></tr> <tr><td>ISPW_Src_Level</td> <td>DEV1</td> <td>ISPW Level the promote has been started from</td></tr> <tr><td>ISPW_Release</td> <td></td> <td>ISPW Release Name</td></tr> <tr><td>ISPW_Container</td> <td></td> <td>ISPW Set ID</td></tr> <tr><td>ISPW_Container_Type</td> <td>2</td> <td>ISPW Container Type (0. - assignment, 1. - release, 2. - set)</td></tr> <tr><td>ISPW_Owner</td> <td></td> <td>ISPW Owner User ID</td></tr></tbody></table> <p>The second set of parameters is installation specific and reference tokens and other IDs that have been defined during the configuration phase. To determine the approriate values to use refer to the <a href="/pipelines/pipeline_parameters.html">description of the pipeline parameters</a>.</p> <table><thead><tr><th>Name</th> <th>Description</th></tr></thead> <tbody><tr><td>CES_Token</td> <td>Jenkins internal Token ID for the CES Token</td></tr> <tr><td>HCI_Conn_ID</td> <td>Jenkins internal ID for HCI Connection</td></tr> <tr><td>HCI_Token</td> <td>Jenkins internal ID for HCI Token</td></tr> <tr><td>CC_repository</td> <td>Code Coverage Repository - Check with your Xpediter Code Coverage administrator for the name to use</td></tr> <tr><td>Git_Project</td> <td>Github (or other Git based repository) project used to store the Topaz for Total Test Projects</td></tr></tbody></table> <h3 id="loading-the-script-from-github"><a href="#loading-the-script-from-github" aria-hidden="true" class="header-anchor">#</a> Loading the script from GitHub</h3> <p>Instead of using a Pipeline script and placing the pipeline code into the Script text box, the pipeline uses a Pipeline from SCM stored in GitHub.</p> <p><img src="/assets/img/Pipeline_from_SCM.00183829.png" alt="Pipeline from SCM"></p> <h2 id="jenkins-pipeline-script"><a href="#jenkins-pipeline-script" aria-hidden="true" class="header-anchor">#</a> Jenkins Pipeline Script</h2> <p>Once this pipeline has been triggered, the pipeline will perform the following steps</p> <ol><li>Initialize globaly variables determine and determine which <code>runner.jcl</code> to use</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token keyword">def</span> String <span class="token function">getPathNum</span><span class="token punctuation">(</span>String Level<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">return</span> Level<span class="token operator">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>Level<span class="token operator">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">...</span>
<span class="token comment">// Determine the current ISPW Path and Level that the code Promotion is from</span>
<span class="token keyword">def</span> PathNum <span class="token operator">=</span> <span class="token function">getPathNum</span><span class="token punctuation">(</span>ISPW_Level<span class="token punctuation">)</span>

<span class="token comment">// Use the Path Number to determine the right Runner JCL to use (different STEPLIB concatenations)</span>
<span class="token keyword">def</span> TTT_Jcl <span class="token operator">=</span> <span class="token string gstring">&quot;Runner_PATH&quot;</span> <span class="token operator">+</span> PathNum <span class="token operator">+</span> <span class="token string gstring">&quot;.jcl&quot;</span>
<span class="token comment">// Also set the Level that the code currently resides in</span>
<span class="token keyword">def</span> ISPW_Target_Level <span class="token operator">=</span> <span class="token string gstring">&quot;QA&quot;</span> <span class="token operator">+</span> PathNum
</code></pre></div><ol start="2"><li>Download all COBOL sources and COBOL copybooks from ISPW (the mainframe) that are part of the set triggering this specific pipeline execution, using the ISPW Container downloader</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Retrieve Code From ISPW&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token comment">//Retrieve the code from ISPW that has been promoted </span>
        <span class="token function">checkout</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'IspwContainerConfiguration'</span><span class="token punctuation">,</span> 
        componentType<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                  <span class="token comment">// optional filter for component types in ISPW</span>
        connectionId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>HCI_Conn_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>     
        credentialsId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>HCI_Token<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>      
        containerName<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>SetId<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>   
        containerType<span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token punctuation">,</span>                 <span class="token comment">// 0-Assignment 1-Release 2-Set</span>
        ispwDownloadAll<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>             <span class="token comment">// false will not download files that exist in the workspace and haven't previous changed</span>
        serverConfig<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                   <span class="token comment">// ISPW runtime config.  if blank ISPW will use the default runtime config</span>
        serverLevel<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment">// level to download the components from</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>Clone the Git repository for the ISPW application, using the fixed stream name <code>FTSDEMO</code> in our examples, using the <code>gitcheckout</code> method defined at the beginning of the script. The method uses the Git SCM plugin.</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token keyword">def</span> <span class="token function">gitcheckout</span><span class="token punctuation">(</span>String URL<span class="token punctuation">,</span> String Branch<span class="token punctuation">,</span> String Credentials<span class="token punctuation">,</span> String Folder<span class="token punctuation">)</span>
 <span class="token punctuation">{</span>
        println <span class="token string gstring">&quot;Scenario &quot;</span> <span class="token operator">+</span> URL
        println <span class="token string gstring">&quot;Scenario &quot;</span> <span class="token operator">+</span> Branch
        println <span class="token string gstring">&quot;Scenario &quot;</span> <span class="token operator">+</span> Credentials

        checkout changelog<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> poll<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
            scm<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'GitSCM'</span><span class="token punctuation">,</span> 
            branches<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>name<span class="token punctuation">:</span> <span class="token string gstring">&quot;*/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>Branch<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
            doGenerateSubmoduleConfigurations<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> 
            extensions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'RelativeTargetDirectory'</span><span class="token punctuation">,</span> relativeTargetDir<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>Folder<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
            submoduleCfg<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
            userRemoteConfigs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>credentialsId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>Credentials<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'origin'</span><span class="token punctuation">,</span> url<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>URL<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
 <span class="token punctuation">}</span>

<span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Retrieve Tests&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">//Retrieve the Tests from Github that match that ISPWW Stream and Application</span>
    Git_URL <span class="token operator">=</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>Git_URL<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>Git_TTT_Repo<span class="token punctuation">}</span></span>&quot;</span>

    <span class="token comment">//call gitcheckout wrapper function</span>
    <span class="token function">gitcheckout</span><span class="token punctuation">(</span>Git_URL<span class="token punctuation">,</span> Git_Branch<span class="token punctuation">,</span> Git_Credentials<span class="token punctuation">,</span> <span class="token string gstring">&quot;tests&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="4"><li>Build a list of all downloaded COBOL sources</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// Get all Cobol Sources in the MF_Source folder into an array </span>
<span class="token keyword">def</span> ListOfSources  <span class="token operator">=</span> <span class="token function">findFiles</span><span class="token punctuation">(</span>glob<span class="token punctuation">:</span> <span class="token string gstring">&quot;**/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Application<span class="token punctuation">}</span></span>/<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>MF_Source<span class="token punctuation">}</span></span>/*.cbl&quot;</span><span class="token punctuation">)</span>

<span class="token comment">// Define a empty array for the list of programs</span>
<span class="token keyword">def</span> ListOfPrograms <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token string regex">//</span> Determine program names <span class="token keyword">for</span> each source member
ListOfSources<span class="token operator">.</span>each
<span class="token punctuation">{</span>
    <span class="token string regex">//</span> The split method uses regex to search <span class="token keyword">for</span> patterns<span class="token punctuation">,</span> therefore
    <span class="token string regex">//</span> Backslashes<span class="token punctuation">,</span> Dots and Underscores which mean certain patterns <span class="token keyword">in</span> regex need to be escaped 
    <span class="token string regex">//</span> The backslash <span class="token keyword">in</span> Windows paths is duplicated <span class="token keyword">in</span> Java<span class="token punctuation">,</span> therefore it need to be escaped twice
    <span class="token string regex">//</span> Trim <span class="token operator">.</span><span class="token operator">/</span>cbl from the Source members to populate the array of program names
    ListOfPrograms<span class="token operator">.</span><span class="token function">add</span><span class="token punctuation">(</span>it<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">&quot;\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li>Build a list of all downloaded Topaz for Total Test <code>.testscenario</code> files</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token comment">// findFiles method requires the &quot;Pipeline Utilities Plugin&quot;</span>
<span class="token comment">// Get all testscenario files in the current workspace into an array</span>
<span class="token keyword">def</span> TTTListOfScenarios <span class="token operator">=</span> <span class="token function">findFiles</span><span class="token punctuation">(</span>glob<span class="token punctuation">:</span> <span class="token string">'**/*.testscenario'</span><span class="token punctuation">)</span>
</code></pre></div><ul><li>match the two lists and execute all unit test scenarios that have a matching COBOL source; execution of the unit tests will collect code coverage data, using the Topaz for Total Test plugin</li></ul> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Execute related Unit Tests&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Loop through all downloaded Topaz for Total Test scenarios</span>
    TTTListOfScenarios<span class="token operator">.</span>each
    <span class="token punctuation">{</span>

        <span class="token comment">// Get root node of the path, i.e. the name of the Total Test project</span>
        <span class="token keyword">def</span> TTTScenarioPath        <span class="token operator">=</span> it<span class="token operator">.</span>path <span class="token comment">// Fully qualified name of the Total Test Scenario file</span>
        <span class="token keyword">def</span> TTTProjectName         <span class="token operator">=</span> it<span class="token operator">.</span>path<span class="token operator">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">&quot;\\\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string gstring">&quot;\\&quot;</span><span class="token operator">+</span> it<span class="token operator">.</span>path<span class="token operator">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">&quot;\\\\&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment">// Total Test Project name is the root folder of the full path to the testscenario </span>
        <span class="token keyword">def</span> TTTScenarioFullName    <span class="token operator">=</span> it<span class="token operator">.</span>name  <span class="token comment">// Get the full name of the testscenario file i.e. &quot;name.testscenario&quot;</span>
        <span class="token keyword">def</span> TTTScenarioName        <span class="token operator">=</span> it<span class="token operator">.</span>name<span class="token operator">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">&quot;\\.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">// Get the name of the scenario file without &quot;.testscenario&quot;</span>
        <span class="token keyword">def</span> TTTScenarioTarget      <span class="token operator">=</span> TTTScenarioName<span class="token operator">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string gstring">&quot;\\_&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment">// Target Program will be the first part of the scenario name (convention)</span>

        <span class="token comment">// For each of the scenarios walk through the list of source files and determine if the target matches one of the programs</span>
        <span class="token comment">// In that case, execute the unit test.  Determine if the program name matches the target of the Total Test scenario</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>ListOfPrograms<span class="token operator">.</span><span class="token function">contains</span><span class="token punctuation">(</span>TTTScenarioTarget<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Log which </span>
            println <span class="token string gstring">&quot;*************************&quot;</span>
            println <span class="token string gstring">&quot;Scenario &quot;</span> <span class="token operator">+</span> TTTScenarioFullName
            println <span class="token string gstring">&quot;Path &quot;</span> <span class="token operator">+</span> TTTScenarioPath
            println <span class="token string gstring">&quot;Project &quot;</span> <span class="token operator">+</span> TTTProjectName
            println <span class="token string gstring">&quot;*************************&quot;</span>
        
            <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'TotalTestBuilder'</span><span class="token punctuation">,</span> 
                ccClearStats<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>                <span class="token comment">// Clear out any existing Code Coverage stats for the given ccSystem and ccTestId</span>
                ccRepo<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>CC_repository<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>         
                ccSystem<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Application<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> 
                ccTestId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>BUILD_NUMBER<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>        <span class="token comment">// Jenkins environment variable, resolves to build number, i.e. #177 </span>
                credentialsId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>HCI_Token<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> 
                deleteTemp<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>                   <span class="token comment">// (true|false) Automatically delete any temp files created during the execution</span>
                hlq<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>                            <span class="token comment">// Optional - high level qualifier used when allocation datasets</span>
                connectionId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>HCI_Conn_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>    
                jcl<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>TTT_Jcl<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>                  <span class="token comment">// Name of the JCL file in the Total Test Project to execute</span>
                projectFolder<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>TTTProjectName<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Name of the Folder in the file system that contains the Total Test Project.  </span>
                testSuite<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>TTTScenarioFullName<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span><span class="token comment">// Name of the Total Test Scenario to execute</span>
                useStubs<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">]</span><span class="token punctuation">)</span>                   <span class="token comment">// (true|false) - Execute with or without stubs</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="6"><li>Download code coverage results from the underlying <a href="https://compuware.com/xpediter-mainframe-debugging-tools/" target="_blank" rel="noopener noreferrer">Xpediter Code Coverage<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> repository, using the Xpediter Code Coverage plugin</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Collect Coverage Metrics&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token comment">// Code Coverage needs to match the code coverage metrics back to the source code in order for them to be loaded in SonarQube</span>
        <span class="token comment">// The source variable is the location of the source that was downloaded from ISPW</span>
        <span class="token keyword">def</span> String sources<span class="token operator">=</span><span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Application<span class="token punctuation">}</span></span>\\${MF_Source}&quot;</span>

        <span class="token comment">// The Code Coverage Plugin passes it's primary configuration in the string or a file</span>
        <span class="token keyword">def</span> ccproperties <span class="token operator">=</span> <span class="token string">'cc.sources='</span> <span class="token operator">+</span> sources <span class="token operator">+</span> <span class="token string">'\rcc.repos='</span> <span class="token operator">+</span> CC_repository <span class="token operator">+</span> <span class="token string">'\rcc.system='</span> <span class="token operator">+</span> ISPW_Application  <span class="token operator">+</span> <span class="token string">'\rcc.test='</span> <span class="token operator">+</span> BUILD_NUMBER

        <span class="token function">step</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">$</span><span class="token keyword">class</span><span class="token punctuation">:</span> <span class="token string">'CodeCoverageBuilder'</span><span class="token punctuation">,</span>
        analysisProperties<span class="token punctuation">:</span> ccproperties<span class="token punctuation">,</span>       <span class="token comment">// Pass in the analysisProperties as a string</span>
        analysisPropertiesPath<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>             <span class="token comment">// Pass in the analysisProperties as a file.  Not used in this example</span>
        connectionId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>HCI_Conn_ID<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span> 
        credentialsId<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>HCI_Token<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><ol start="7"><li>Pass downloaded COBOL sources, the results of the unit tests, and code coverage metrics to SonarQube using the Sonar Scanner</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Check SonarQube Quality Gate&quot;</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
    <span class="token comment">// Requires SonarQube Scanner 2.8+</span>
    <span class="token comment">// Retrieve the location of the SonarQube Scanner.  </span>
    <span class="token keyword">def</span> scannerHome <span class="token operator">=</span> tool <span class="token string">'scanner'</span><span class="token punctuation">;</span>   <span class="token comment">// 'scanner' is the name defined for the SonarQube scanner defined in Jenkins / Global Tool Configuration / SonarQube Scanner section</span>
    <span class="token function">withSonarQubeEnv</span><span class="token punctuation">(</span><span class="token string">'localhost'</span><span class="token punctuation">)</span>       <span class="token comment">// 'localhost' is the name of the SonarQube server defined in Jenkins / Configure Systems / SonarQube server section</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Finds all of the Total Test results files that will be submitted to SonarQube</span>
        <span class="token keyword">def</span> TTTListOfResults <span class="token operator">=</span> <span class="token function">findFiles</span><span class="token punctuation">(</span>glob<span class="token punctuation">:</span> <span class="token string">'TTTSonar/*.xml'</span><span class="token punctuation">)</span>   <span class="token comment">// Total Test SonarQube result files are stored in TTTSonar directory</span>

        <span class="token string regex">//</span> Build the sonar testExecutionReportsPaths property
        <span class="token string regex">//</span> Start will the property itself
        <span class="token keyword">def</span> SQ_TestResult          <span class="token operator">=</span> <span class="token string gstring">&quot;-Dsonar.testExecutionReportPaths=&quot;</span>    

        <span class="token string regex">//</span> Loop through each result Total Test results file found
        TTTListOfResults<span class="token operator">.</span>each 
        <span class="token punctuation">{</span>
            <span class="token keyword">def</span> TTTResultName    <span class="token operator">=</span> it<span class="token operator">.</span>name   <span class="token string regex">//</span> Get the name of the Total Test results file   
            SQ_TestResult <span class="token operator">=</span> SQ_TestResult <span class="token operator">+</span> <span class="token string gstring">&quot;TTTSonar/&quot;</span> <span class="token operator">+</span> it<span class="token operator">.</span>name <span class="token operator">+</span>  <span class="token string">','</span> <span class="token string regex">//</span> Append the results file to the property
        <span class="token punctuation">}</span>

        <span class="token string regex">//</span> Build the rest of the SonarQube Scanner Properties
        
        <span class="token string regex">//</span> Test and Coverage results
        <span class="token keyword">def</span> SQ_Scanner_Properties   <span class="token operator">=</span> <span class="token string gstring">&quot; -Dsonar.tests=tests <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>SQ_TestResult<span class="token punctuation">}</span></span> -Dsonar.coverageReportPaths=Coverage/CodeCoverage.xml&quot;</span>
        <span class="token string regex">//</span> SonarQube project to load results into
        SQ_Scanner_Properties <span class="token operator">=</span> SQ_Scanner_Properties <span class="token operator">+</span> <span class="token string gstring">&quot; -Dsonar.projectKey=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>JOB_NAME<span class="token punctuation">}</span></span> -Dsonar.projectName=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>JOB_NAME<span class="token punctuation">}</span></span> -Dsonar.projectVersion=1.0&quot;</span>
        <span class="token string regex">//</span> Location of the Cobol Source Code to scan
        SQ_Scanner_Properties <span class="token operator">=</span> SQ_Scanner_Properties <span class="token operator">+</span> <span class="token string gstring">&quot; -Dsonar.sources=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Application<span class="token punctuation">}</span></span>\\MF_Source&quot;</span>
        <span class="token string regex">//</span> Location of the Cobol copybooks to scan
        SQ_Scanner_Properties <span class="token operator">=</span> SQ_Scanner_Properties <span class="token operator">+</span> <span class="token string gstring">&quot; -Dsonar.cobol.copy.directories=<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Application<span class="token punctuation">}</span></span>\\MF_Source&quot;</span>  
        <span class="token string regex">//</span> File extensions <span class="token keyword">for</span> Cobol and Copybook files<span class="token operator">.</span>  The Total Test files need that contain tests need to be defined <span class="token keyword">as</span> cobol <span class="token keyword">for</span> SonarQube to process the results
        SQ_Scanner_Properties <span class="token operator">=</span> SQ_Scanner_Properties <span class="token operator">+</span> <span class="token string gstring">&quot; -Dsonar.cobol.file.suffixes=cbl,testsuite,testscenario,stub -Dsonar.cobol.copy.suffixes=cpy -Dsonar.sourceEncoding=UTF-8&quot;</span>
        
        <span class="token string regex">//</span> Call the SonarQube Scanner with properties defined above
        bat <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>scannerHome<span class="token punctuation">}</span></span>/bin/sonar-scanner&quot;</span> <span class="token operator">+</span> SQ_Scanner_Properties
    <span class="token punctuation">}</span>
</code></pre></div><ol start="8"><li>Query the resulting Sonar quality gate, by registering a Sonar Webhook call back, if the quality gate fails, the pipeline job will be aborted</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code>
        <span class="token comment">// Wait for the results of the SonarQube Quality Gate</span>
        <span class="token function">timeout</span><span class="token punctuation">(</span>time<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> unit<span class="token punctuation">:</span> <span class="token string">'MINUTES'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            
            <span class="token comment">// Wait for webhook call back from SonarQube.  SonarQube webhook for callback to Jenkins must be configured on the SonarQube server.</span>
            <span class="token keyword">def</span> qg <span class="token operator">=</span> <span class="token function">waitForQualityGate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            
            <span class="token comment">// Evaluate the status of the Quality Gate</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>qg<span class="token operator">.</span>status <span class="token operator">!=</span> <span class="token string">'OK'</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                echo <span class="token string gstring">&quot;Pipeline aborted due to quality gate failure: <span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>qg<span class="token operator">.</span>status<span class="token punctuation">}</span></span>&quot;</span>
                error <span class="token string gstring">&quot;Exiting Pipeline&quot;</span> <span class="token comment">// Exit the pipeline with an error if the SonarQube Quality Gate is failing</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>   
<span class="token punctuation">}</span>
</code></pre></div><ol start="9"><li>If the quality gate passes an XL Release template will be triggered - using the XL Release plugin - to execute CD stages beyond the Jenkins pipeline</li></ol> <div class="language-groovy extra-class"><pre class="language-groovy"><code><span class="token function">stage</span><span class="token punctuation">(</span><span class="token string gstring">&quot;Start release in XL Release&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
        <span class="token comment">// Determine the current ISPW Path and Level that the code Promotion is from</span>
        PathNum <span class="token operator">=</span> <span class="token function">getPathNum</span><span class="token punctuation">(</span>ISPW_Level<span class="token punctuation">)</span>

        <span class="token comment">// Use the Path Number to determine what QA Path to Promote the code from in ISPW.  This example has seperate QA paths in ISPW Lifecycle (i.e. DEV1-&gt;QA1-&gt;STG-&gt;PRD / DEV2-&gt;QA2-&gt;STG-&gt;PRD)</span>
        <span class="token keyword">def</span> XLRPath <span class="token operator">=</span> <span class="token string gstring">&quot;QA&quot;</span> <span class="token operator">+</span> PathNum 

        <span class="token comment">// Trigger XL Release Jenkins Plugin to kickoff a Release</span>
        xlrCreateRelease releaseTitle<span class="token punctuation">:</span> <span class="token string">'A Release for $BUILD_TAG'</span><span class="token punctuation">,</span>
        serverCredentials<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>XLR_User<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">,</span>
        startRelease<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        template<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>XLR_Template<span class="token punctuation">}</span></span>&quot;</span>
        variables<span class="token punctuation">:</span>
        <span class="token punctuation">[</span><span class="token punctuation">[</span>propertyName<span class="token punctuation">:</span><span class="token string">'ISPW_Dev_level'</span><span class="token punctuation">,</span> propertyValue<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Target_Level<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// Level in ISPW that the Code resides currently</span>
        <span class="token punctuation">[</span>propertyName<span class="token punctuation">:</span> <span class="token string">'ISPW_RELEASE_ID'</span><span class="token punctuation">,</span> propertyValue<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>ISPW_Release<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>     <span class="token comment">// ISPW Release value from the ISPW Webhook</span>
        <span class="token punctuation">[</span>propertyName<span class="token punctuation">:</span> <span class="token string">'CES_Token'</span><span class="token punctuation">,</span> propertyValue<span class="token punctuation">:</span> <span class="token string gstring">&quot;<span class="token expression"><span class="token punctuation">$</span><span class="token punctuation">{</span>CES_Token<span class="token punctuation">}</span></span>&quot;</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        
        <a href="/pipelines/Mainframe_CI_Pipeline_from_Shared_Lib.html" class="prev">
          Shared Library Example
        </a></span> <span class="next"><a href="/pipelines/scenario/">
          ISPW Scenario
        </a>
        
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.38dc2da7.js" defer></script><script src="/assets/js/6.955488f3.js" defer></script>
  </body>
</html>
